{
  "id": "plugin-pub-csv",
  "displayName": "File Reader",
  "description": "Publisher which extracts data from delimited and fixed width column flat files.",
  "apiVersion": "2",
  "versionDescription": "Version 4",
  "version": "4.0.0",
  "iconFile": "icon.png",
  "executable": "PluginCSV",
  "kind": "publisher",
  "os": "$GOOS",
  "arch": "$GOARCH",
  "canConfigureRealTime": true,
  "canProduceMultipleSchemas": true,
  "canAcceptQueryBasedSchemas": true,
  "canUseOAuth": false,
  "canWrite": false,
  "canConfigureReplication": false,
  "canWriteReplication": false,
  "querySchema": {
    "ui": {
      "ui:widget": "code",
      "ui:options": {
        "language": "sql"
      }
    },
    "schema": {
      "type": "string"
    }
  },
  "configSchema": {
    "ui": {
      "ui:order": [
        "RootPaths"
      ],
      "RootPaths" : {
        "items": {
          "ui:order": [
            "RootPath",
            "Filter",
            "CleanupAction",
            "ArchivePath",
            "Mode",
            "Delimiter",
            "HasHeader",
            "Columns"
          ],
          "Columns": {
            "items": {
              "ui:order":[
                "ColumnName",
                "IsKey",
                "ColumnStart",
                "ColumnEnd"
              ]
            }
          }
        }
      }
    },
    "schema": {
      "type": "object",
      "properties": {
        "RootPaths": {
          "title": "Root Paths",
          "description": "The folder(s) containing the files.",
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "properties": {
              "RootPath": {
                "title": "Root Path",
                "description": "The folder containing the files",
                "type": "string"
              },
              "Filter": {
                "type": "string",
                "description": "Filters used to select files beneath the root path. Each filter should be a regular expression.",
                "default": "*.csv"
              },
              "Mode": {
                "type": "string",
                "title": "Mode",
                "description": "Mode to use when reading target files.",
                "default": "Delimited",
                "enum": [
                  "Delimited",
                  "Fixed Width Columns"
                ]
              },
              "CleanupAction": {
                "type": "string",
                "title": "Cleanup Action",
                "description": "Action taken to clean up after reading.",
                "default": "Nothing",
                "examples": [
                  "string"
                ],
                "enum": [
                  "Nothing",
                  "Delete",
                  "Archive"
                ]
              }
            },
            "required": [
              "RootPath",
              "Filter",
              "Mode"
            ],
            "dependencies": {
              "Mode": {
                "oneOf":[
                  {
                    "properties":{
                      "Mode": {
                        "enum":[
                          "Delimited"
                        ]
                      },
                      "HasHeader": {
                        "type": "boolean",
                        "title": "Has Header ",
                        "description": "Does the file have a header row?",
                        "default": false,
                        "examples": [
                          true
                        ]
                      },
                      "Delimiter": {
                        "type": "string",
                        "title": "Delimiter",
                        "description": "The delimiter for delimited files.",
                        "default": ",",
                        "examples": [
                          ",",
                          "|"
                        ],
                        "maxLength": 1,
                        "pattern": ""
                      }
                    }
                  },
                  {
                    "properties": {
                      "Mode": {
                        "enum":[
                          "Fixed Width Columns"
                        ]
                      },
                      "Columns": {
                        "type": "array",
                        "minItems": 1,
                        "title": "Columns",
                        "description": "Columns for fixed column width files",
                        "items": {
                          "type": "object",
                          "properties": {
                            "ColumnName": {
                              "title": "Column Name",
                              "description": "The name of the column.",
                              "type": "string"
                            },
                            "ColumnStart": {
                              "title": "Column Start",
                              "description": "The index of the first character of the column (0 is the first index).",
                              "type": "number"
                            },
                            "ColumnEnd": {
                              "title": "Column End",
                              "description": "The index of the last character of the column.",
                              "type": "number"
                            },
                            "IsKey": {
                              "title": "Is Key",
                              "description": "Is this column the key property?",
                              "default": false,
                              "type": "boolean"
                            }
                          },
                          "required": ["ColumnName", "ColumnStart", "ColumnEnd"]
                        }
                      }
                    }
                  }
                ]
              },
              "CleanupAction": {
                "oneOf": [
                  {
                    "properties": {
                      "CleanupAction": {
                        "enum": [
                          "Archive"
                        ]
                      },
                      "ArchivePath": {
                        "type": "string",
                        "title": "Archive Folder",
                        "description": "The folder to move files to after processing, if cleanup action is \"archive\".",
                        "default": "",
                        "examples": [
                          "string"
                        ]
                      }
                    },
                    "required": [
                      "ArchivePath"
                    ]
                  },
                  {
                    "properties": {
                      "CleanupAction": {
                        "enum": [
                          "Nothing","Delete"
                        ]
                      }
                    }
                  }
                ]
              }
            }
          }
        }
      },
      "required": [
        "RootPaths"
      ]
    }
  }
}
